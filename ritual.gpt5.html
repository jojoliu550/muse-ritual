<!doctype html><html lang="zh-CN"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ä»ªå¼è¿›è¡Œä¸­ Â· æƒ…ç»ªåšç‰©é¦†ï¼ˆç¨³å®šç‰ˆv3ï¼šé¢„çƒ­æ”¶å°¾+å½•éŸ³å¯è§+ç»Ÿä¸€æš‚åœï¼‰</title>
<link rel="stylesheet" href="styles.css">
<style>
.hint-overlay{position:fixed;inset:0;background:rgba(0,0,0,.50);display:flex;align-items:center;justify-content:center;z-index:9999}
.hint-card{background:#0f1117;border:1px solid #2a3042;border-radius:16px;padding:16px;max-width:480px;color:#eaeef5;text-align:center;
/* å…³é”®ï¼šå¯æ»šåŠ¨ï¼Œé˜²æ­¢æŒ‰é’®è¢«æŒ¤æ²¡ */
max-height:72vh;overflow:auto}
.hint-title{font-size:18px;margin:2px 0 8px}
.hint-text{font-size:14px;color:#aab3cf;margin-bottom:12px}
.hint-row{display:flex;gap:10px;justify-content:center;margin-bottom:10px;flex-wrap:wrap}
.hint-row button{min-width:150px}
.actions{position:fixed;left:12px;right:12px;bottom:max(12px,env(safe-area-inset-bottom));display:flex;flex-wrap:wrap;gap:10px;justify-content:center;z-index:5}
.actions>button{flex:1 1 160px;min-height:40px;white-space:nowrap}
.small{font-size:12px;color:#aab3cf}
</style>
</head>
<body>
<main class="container">
  <div class="card">
    <div id="scene" class="scene">

      <!-- å¼€åœºé®ç½©ï¼šæ•´å—å¯è§¦å‘ + å†…è”æŒ‰é’® -->
      <div id="hint" class="hint-overlay" ontouchstart="__start()" onclick="__start()">
        <div class="hint-card">
          <div class="hint-title">å‡†å¤‡å¼€å§‹</div>
          <div class="hint-text">ç‚¹ä»»æ„å¤„æˆ–ä¸‹æ–¹æŒ‰é’®å¼€å¯å£°éŸ³ï¼ˆå¯å…ˆå½• 5â€“30 ç§’â€œåŸå£°â€ï¼‰</div>

          <div class="hint-row">
            <button onclick="__beep()">è¯•å¬å¥³ç”Ÿ</button>
            <button onclick="__beep()">è¯•å¬ç”·ç”Ÿ</button>
            <button id="recBtn" onclick="__toggleRec()">ğŸ™ï¸ å½•éŸ³æˆ‘çš„åŸå£°ï¼ˆä¸Šé™30ç§’ï¼‰</button>
          </div>
          <div id="recInfo" class="small" style="display:none"></div>

          <button id="startPlay" class="primary" onclick="__start()">å¼€å§‹</button>
          <div class="small" style="margin-top:6px">è¯´æ˜ï¼šå½•éŸ³ä»…ä¿å­˜åœ¨æœ¬æœºä¸´æ—¶å†…å­˜ï¼Œä¸ä¸Šä¼ </div>
        </div>
      </div>

      <!-- èˆå°ä¿¡æ¯/åŠ¨ä½œ -->
      <div class="badge" id="badge"></div>
      <div class="countdown" id="countdown">--:--</div>
      <div class="marquee" id="marquee"></div>

      <div class="actions">
        <button id="pause" onclick="__pause()">æš‚åœ</button>
        <button id="finish" onclick="__finishNow()">æå‰ç»“æŸ</button>
        <button id="shareLanding" class="secondary" onclick="__shareLanding()">é‚€è¯·å¥½å‹æ¥ç©</button>
        <button id="shareReplay"  class="secondary" onclick="__shareReplay()">åˆ†äº«å®Œæ•´æµç¨‹</button>
        <button id="tipBtn"       class="secondary" onclick="__tip()">æ‰“èµæ”¯æŒ</button>
      </div>
    </div>
    <p class="muted center">è‹¥æ²¡æœ‰å£°éŸ³ï¼šå…ˆç‚¹â€œè¯•å¬â€æˆ–ä»»æ„ä½ç½®ï¼›iPhone è¯·å…³é—­æœºèº«é™éŸ³é”®ã€‚</p>
  </div>
</main>

<footer class="footer">Â© æƒ…ç»ªåšç‰©é¦†</footer>

<!-- æ‰“èµå¼¹å±‚ -->
<style>
.tip-mask{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:99999}
.tip-card{background:#0f1117;border:1px solid #2a3042;border-radius:14px;padding:16px 16px 12px;max-width:440px;color:#eaeef5}
.tip-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tip-box{border:1px dashed #394058;border-radius:12px;min-height:180px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.tip-box img{max-width:100%;max-height:240px;display:block}
.tip-alt{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#aab3cf;font-size:13px}
.tip-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
</style>
<div id="tipModal" class="tip-mask" onclick="if(event.target===this)this.style.display='none'">
  <div class="tip-card">
    <h3>æ‰“èµæ”¯æŒï¼ˆè°¢è°¢ä½ ï¼‰</h3>
    <div class="tip-grid">
      <div class="tip-box">
        <img id="wxQR" src="assets/tip_wechat.jpg" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
        <div class="tip-alt" style="display:none">æ”¾å…¥<br>assets/tip_wechat.jpg</div>
      </div>
      <div class="tip-box">
        <img id="aliQR" src="assets/tip_alipay.jpg" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
        <div class="tip-alt" style="display:none">æ”¾å…¥<br>assets/tip_alipay.jpg</div>
      </div>
    </div>
    <div class="tip-actions">
      <button class="secondary" onclick="document.getElementById('tipModal').style.display='none'">å…³é—­</button>
    </div>
  </div>
</div>

<!-- åˆ†äº«å¼¹å±‚ -->
<style>
.share-mask{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999}
.share-card{background:#0f1117;border:1px solid #2a3042;border-radius:14px;padding:16px;max-width:460px;color:#eaeef5}
.share-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.share-box{border:1px dashed #394058;border-radius:12px;min-height:160px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.share-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
</style>
<div id="shareModal" class="share-mask" onclick="if(event.target===this)this.style.display='none'">
  <div class="share-card">
    <h3 id="shareTitle">åˆ†äº«é“¾æ¥</h3>
    <div class="share-grid">
      <div class="share-box" style="padding:10px">
        <input id="shareInput" readonly style="width:100%;padding:10px;border-radius:8px;background:#0d0f18;color:#eaeef5;border:1px solid #2a3042">
        <p class="small" style="margin-top:8px">é•¿æŒ‰æˆ–ç‚¹â€œå¤åˆ¶â€</p>
        <div class="share-actions" style="justify-content:flex-start">
          <button class="secondary" onclick="__copyShare()">å¤åˆ¶</button>
        </div>
      </div>
      <div class="share-box">
        <img id="shareQR" alt="äºŒç»´ç ">
      </div>
    </div>
    <div class="share-actions">
      <button class="secondary" onclick="document.getElementById('shareModal').style.display='none'">å…³é—­</button>
    </div>
  </div>
</div>

<script>
/* ===== å·¥å…· & æ•°æ® ===== */
function $(id){ return document.getElementById(id); }
function parseData(){
  try{
    var raw=(location.hash||'').slice(1);
    if(!raw) return null;
    var b64=raw.split('&')[0];
    return JSON.parse(decodeURIComponent(escape(atob(b64))));
  }catch(e){ return null; }
}
var data=parseData();
if(!data){ document.body.innerHTML='<div class="container"><div class="card">æ•°æ®ä¸¢å¤±ï¼Œè¯·è¿”å›å…¥å£</div></div>'; throw new Error('no data'); }
var key=String(data.ts), cid=(data.cid||String(data.ts)), id=key.slice(-6);

/* å£°éŸ³æŒ‡ç¤ºç‚¹ */
(function(){ var dot=document.createElement('div'); dot.id='soundDot';
  dot.style.cssText='position:fixed;right:8px;top:8px;width:10px;height:10px;border-radius:50%;background:#f55;opacity:.9;z-index:99999';
  document.addEventListener('DOMContentLoaded',function(){ document.body.appendChild(dot); });
})();
function setDot(ok){ var d=$('soundDot'); if(d) d.style.background=ok?'#2ecc71':'#f55'; }

/* èˆå°/çŠ¶æ€ */
var badgeEl=$('badge'), cdEl=$('countdown'), mqEl=$('marquee');
var paused=false, bgm=null, voice=null, emcee=null;
var emceeOpen=null, emceeClose=null; // é¢„çƒ­åçš„å¼€åœº/æ”¶å°¾
var narrationDone=false;
var endAt=0, tickTimer=null;
var duration = Number(data.duration)||180;
var CLOSE_BEFORE = duration>=300?10: duration>=180?9:8;
var closingStarted=false;

/* ===== éŸ³é¢‘è§£é” + è¯•å¬å“”å£° ===== */
function __unlock(){
  try{
    var AC=window.AudioContext||window.webkitAudioContext;
    if(AC){ var ctx=new AC(); if(ctx.resume) ctx.resume();
      var o=ctx.createOscillator(), g=ctx.createGain(); g.gain.value=0; o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.02);
    }
  }catch(e){}
  try{ var a=new Audio(); a.src='data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBIAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='; a.muted=true; a.playsInline=true; a.play().then(function(){ a.pause(); setDot(true); }).catch(function(){}); }catch(e){}
}
function __beep(){
  __unlock();
  try{
    var AC=window.AudioContext||window.webkitAudioContext; if(!AC) return;
    var ctx=new AC(); var o=ctx.createOscillator(); var g=ctx.createGain();
    o.type='sine'; o.frequency.value=880; g.gain.value=0.22;
    o.connect(g).connect(ctx.destination); o.start(); setDot(true);
    setTimeout(function(){ try{o.stop(); ctx.close&&ctx.close();}catch(_){}} ,180);
  }catch(e){}
}

/* ===== çœŸå®æ—¶é—´å€’è®¡æ—¶ï¼ˆé©±åŠ¨â€œå»¶è¿Ÿæ”¶å°¾â€ï¼‰ ===== */
function fmt(sec){ var m=('0'+Math.floor(sec/60)).slice(-2); var s=('0'+(sec%60)).slice(-2); return m+':'+s; }
function startClock(seconds){
  endAt = Date.now() + seconds*1000;
  function loop(){
    if(paused){ tickTimer=setTimeout(loop,300); return; }
    var left = Math.max(0, Math.ceil((endAt - Date.now())/1000));
    cdEl.textContent = fmt(left);

    if(!closingStarted && left<=CLOSE_BEFORE){
      closingStarted=true;
      if(emceeClose){
        emcee = emceeClose; try{ emcee.play(); }catch(e){}
        emcee.onended=function(){ narrationDone=true; };
      }else{
        playEmcee('close').then(function(){ narrationDone=true; });
      }
    }

    if(left===0){
      if(narrationDone){ __finish(); return; }
      tickTimer=setTimeout(loop, 400);
    }else{
      tickTimer=setTimeout(loop, 250);
    }
  }
  if(tickTimer) clearTimeout(tickTimer);
  loop();
}

/* ===== èƒŒæ™¯ä¸»é¢˜ï¼ˆç•¥æé€Ÿæ˜Ÿç©ºï¼‰ ===== */
function __theme(){
  var scene=$('scene'); if(!scene) return;
  try{
    var bg=(function(){ try{ return sessionStorage.getItem('bg_'+key) || ''; }catch(_){ return ''; } })();
    var src=(bg && bg.indexOf('data:image/')===0)?bg:'assets/bg_custom.jpg';
    scene.style.backgroundImage='linear-gradient(to bottom, rgba(24,26,36,.30), rgba(24,26,36,.40)), url("'+src+'")';
    scene.style.backgroundSize='cover'; scene.style.backgroundPosition='center'; scene.style.backgroundRepeat='no-repeat';
  }catch(e){}
  var th=(data.theme==='candles'?'candle':data.theme);
  if(th==='star'){
    scene.classList.add('starfield');
    for(var i=0;i<130;i++){
      var s=document.createElement('div'); s.className='star';
      s.style.left=(Math.random()*120-10)+'vw'; s.style.top=(Math.random()*100)+'%';
      s.style.setProperty('--spd', (10+Math.random()*10)+'s');
      s.style.opacity=0.5+Math.random()*0.45;
      scene.appendChild(s);
    }
  }else if(th==='neon'){
    scene.classList.add('neon'); var bar=document.createElement('div'); bar.className='neon-bar'; scene.appendChild(bar);
  }else{
    scene.classList.add('dark-vignette'); for(var j=0;j<12;j++){ var f=document.createElement('div'); f.className='flame'; f.style.left=(5+Math.random()*90)+'%'; f.style.bottom=(6+Math.random()*26)+'%'; scene.appendChild(f); }
  }
}

/* ===== èµ„æºï¼šå¯æ’­æ”¾ä¸é¢„çƒ­ ===== */
function pickPlayable(srcs, vol, loop){
  return new Promise(function(resolve){
    (function tryNext(i){
      if(i>=srcs.length){ resolve(null); return; }
      var s=srcs[i]; if(!s){ tryNext(i+1); return; }
      var a=new Audio(); a.src=s; a.playsInline=true; a.preload='auto';
      if(loop) a.loop=true;
      if(typeof vol==='number') a.volume=Math.max(0,Math.min(1,vol));
      var tried=false;
      a.addEventListener('playing', function(){ setDot(true); });
      var p=a.play();
      if(p && p.catch){ p.catch(function(){ if(!tried){ tried=true; tryNext(i+1);} }); }
      setTimeout(function(){ if(a.paused){ try{a.pause();}catch(_){ } if(!tried){ tried=true; tryNext(i+1);} } else { resolve(a); } }, 180);
    })(0);
  });
}
function pickPrewarm(srcs){ // é¢„çƒ­ï¼šmuted æ’­ä¸€å¸§â†’æš‚åœ
  return new Promise(function(resolve){
    (function tryNext(i){
      if(i>=srcs.length){ resolve(null); return; }
      var s=srcs[i]; if(!s){ tryNext(i+1); return; }
      var a=new Audio(); a.src=s; a.playsInline=true; a.preload='auto'; a.muted=true;
      var p=a.play();
      if(p && p.then){
        p.then(function(){ try{ a.pause(); a.muted=false; }catch(_){ } resolve(a); })
         .catch(function(){ tryNext(i+1); });
      }else{
        setTimeout(function(){ try{ a.pause(); a.muted=false; resolve(a); }catch(_){ tryNext(i+1); } }, 120);
      }
    })(0);
  });
}

function playEmcee(kind){ // ç«‹å³æ’­æ”¾ï¼ˆå…œåº•ï¼‰
  return new Promise(function(resolve){
    var gender = (data.emcee_gender || 'female');
    var base = 'assets/emcee_'+(gender==='male'?'male':'female')+'_'+kind;
    var cand=[base+'.m4a', base+'.mp3', base+'.ogg', base+'.wav'];
    pickPlayable(cand, 1, false).then(function(a){
      if(!a){ resolve(); return; }
      emcee = a; emcee.onended=function(){ resolve(); };
    });
  });
}
function preloadEmcee(kind){
  var gender=(data.emcee_gender||'female');
  var base='assets/emcee_'+(gender==='male'?'male':'female')+'_'+kind;
  var cand=[base+'.m4a', base+'.mp3', base+'.ogg', base+'.wav'];
  return pickPrewarm(cand);
}

function startBGM(){
  return new Promise(function(resolve){
    var ss=null; try{ ss=sessionStorage.getItem('bgm_'+key)||''; }catch(_){}
    var srcs=[ss,'assets/bgm_default.m4a','assets/bgm_default.mp3','assets/bgm_default.ogg','assets/bgm_default.wav'];
    pickPlayable(srcs, 0.0001, true).then(function(a){
      bgm=a;
      setTimeout(function(){
        try{
          var target=(typeof data.bgmVol==='number'?data.bgmVol:0.28);
          var steps=14, delta=(target-(bgm?bgm.volume:0))/steps, n=0;
          var idv=setInterval(function(){ n++; try{ if(bgm){ bgm.volume=Math.max(0, Math.min(1, (bgm.volume||0)+delta)); } }catch(e){} if(n>=steps) clearInterval(idv); }, 120);
        }catch(e){}
      }, 200);
      resolve();
    });
  });
}

/* ===== æœ¬åœ°å½•éŸ³ï¼ˆMediaRecorderï¼‰ ===== */
var rec=null, recChunks=[], recStream=null, recTimer=null, recStart=0;
function __toggleRec(){
  if(rec && rec.state==='recording'){ __stopRec(); return; }
  __startRec();
}
function __startRec(){
  __unlock();
  var btn=$('recBtn'), info=$('recInfo'); if(info){ info.style.display='block'; info.textContent='è¯·æ±‚éº¦å…‹é£æƒé™â€¦'; }
  var mime = '';
  try{
    if(window.MediaRecorder && MediaRecorder.isTypeSupported){
      if(MediaRecorder.isTypeSupported('audio/mp4')) mime='audio/mp4';
      else if(MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) mime='audio/webm;codecs=opus';
      else if(MediaRecorder.isTypeSupported('audio/webm')) mime='audio/webm';
    }
  }catch(_){}
  navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){
    recStream=stream; recChunks=[];
    try{ rec=new MediaRecorder(stream, mime?{mimeType:mime}:{}) }catch(e){ rec=new MediaRecorder(stream); }
    rec.ondataavailable=function(e){ if(e.data && e.data.size>0) recChunks.push(e.data); };
    rec.onstop=function(){
      try{ recStream.getTracks().forEach(function(t){ t.stop(); }); }catch(_){}
      var blob=new Blob(recChunks, {type: mime||'audio/webm'});
      var fr=new FileReader(); fr.onload=function(){
        try{ sessionStorage.setItem('voice_'+key, fr.result); }catch(_){}
        if(info){ info.textContent='å·²å½•åˆ¶ '+Math.round((Date.now()-recStart)/1000)+' ç§’ï¼ˆå¼€å§‹æŒ‰é’®å¯ç›´æ¥æ’­æ”¾åŸå£°ï¼‰'; }
        btn.textContent='ğŸ™ï¸ é‡æ–°å½•éŸ³';
      }; fr.readAsDataURL(blob);
    };
    rec.start(200); recStart=Date.now();
    btn.textContent='â¹ï¸ åœæ­¢å½•éŸ³'; if(info){ info.style.display='block'; info.textContent='æ­£åœ¨å½•éŸ³â€¦ æœ€é•¿ 30 ç§’'; }
    recTimer=setTimeout(__stopRec, 30000);
  }).catch(function(){
    if(info){ info.textContent='æ— æ³•è·å–éº¦å…‹é£æƒé™ï¼ˆè¯·åœ¨æµè§ˆå™¨è®¾ç½®é‡Œå…è®¸éº¦å…‹é£ï¼‰'; }
  });
}
function __stopRec(){
  var btn=$('recBtn'); var info=$('recInfo');
  try{ if(rec && rec.state==='recording') rec.stop(); }catch(_){}
  try{ if(recTimer){ clearTimeout(recTimer); recTimer=null; } }catch(_){}
  if(btn) btn.textContent='ğŸ™ï¸ é‡æ–°å½•éŸ³';
  if(info){ info.style.display='block'; info.textContent='å½•éŸ³ç»“æŸ'; }
}

/* ===== ä¸»æ®µï¼šåŸå£°ä¼˜å…ˆï¼ˆä¸Šä¼ æˆ–åˆšå½•çš„ï¼‰ ===== */
function playMain(){
  return new Promise(function(resolve){
    var vss=null; try{ vss=sessionStorage.getItem('voice_'+key)||''; }catch(_){}
    if(vss){
      var isVideo=/^data:video\//i.test(vss);
      voice = isVideo? document.createElement('video') : new Audio();
      voice.src=vss; voice.playsInline=true;
      if(isVideo){ voice.style.cssText='position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;'; document.body.appendChild(voice); }
      var pv=voice.play(); if(pv&&pv.catch){ pv.catch(function(){}); }
      voice.onplay=function(){ setDot(true); };
      voice.onended=function(){ resolve(); };
    }else{
      resolve();
    }
  });
}

/* ===== å¯åŠ¨æµç¨‹ï¼šæ‰‹åŠ¿å†…é¢„çƒ­â€œæ”¶å°¾â€ ===== */
function __start(){
  if(window.__starting) return; window.__starting=true;
  var hint=$('hint'); if(hint) hint.style.display='none';

  badgeEl.textContent='ä¸º '+(data.yourName||'ä½ ')+' ä¸ '+(data.aiName||'TA')+' çš„ä»ªå¼ Â· NO.'+id;
  mqEl.textContent=(data.letter||'ï¼ˆåœ¨è¿™é‡Œï¼Œå¯¹è¿‡å»çš„è‡ªå·±æ¸©æŸ”åœ°é“ä¸€å£°å†è§â€¦ï¼‰');
  __unlock(); __theme();

  // æ‰‹åŠ¿å†…ï¼šé¢„çƒ­å¼€åœº/æ”¶å°¾ + å¯åŠ¨ BGM
  Promise.all([ startBGM(), preloadEmcee('open'), preloadEmcee('close') ]).then(function(arr){
    emceeOpen = arr[1]; emceeClose = arr[2];
    if(emceeOpen){ emcee = emceeOpen; try{ emcee.play(); }catch(e){} }
    else{ playEmcee('open'); }
    startClock(duration);
    return playMain();
  }).then(function(){ /* æ”¶å°¾ç”±å€’è®¡æ—¶æœ€åå‡ ç§’è§¦å‘ */ });
}

/* æå‰ç»“æŸï¼ˆæŒ‰é’®ï¼‰ */
function __finishNow(){ closingStarted=true; narrationDone=true; __finish(); }

/* æš‚åœ/ç»§ç»­ï¼ˆç»Ÿä¸€æ§åˆ¶ BGM + å¸ä»ª + åŸå£°ï¼‰ */
function __pause(){
  if(!paused){
    paused=true; $('pause').textContent='ç»§ç»­';
    try{ bgm && !bgm.paused && bgm.pause(); }catch(e){}
    try{ voice && !voice.paused && voice.pause(); }catch(e){}
    try{ emcee && !emcee.paused && emcee.pause(); }catch(e){}
  }else{
    paused=false; $('pause').textContent='æš‚åœ';
    var mm=$('countdown').textContent.split(':'), left=(parseInt(mm[0]||'0',10)*60 + parseInt(mm[1]||'0',10))||0;
    endAt = Date.now() + left*1000;
    try{ bgm && bgm.paused && bgm.play(); }catch(e){}
    try{ voice && voice.paused && voice.play(); }catch(e){}
    try{ emcee && emcee.paused && emcee.play(); }catch(e){}
  }
}

/* çœŸæ­£ç»“æŸï¼šæ·¡å‡º BGM â†’ è·³è¯ä¹¦ */
function __finish(){
  try{
    if(bgm){
      var n=10,step=(bgm.volume||0)/10;
      var id=setInterval(function(){ n--; try{ bgm.volume=Math.max(0,bgm.volume-step); }catch(e){} if(n<=0){ clearInterval(id); try{ bgm.pause(); }catch(e){} } },100);
    }
  }catch(e){}
  location.href='certificate.html#'+location.hash.slice(1);
}

/* åˆ†äº«/æ‰“èµ */
function __landingURL(){ try{ var u=new URL('index.html', location.href).href; return u.replace(/index\.html(\?|#|$)/,'$1'); }catch(e){ return 'index.html'; } }
function __openShare(link,title){
  var m=$('shareModal'),input=$('shareInput'),qr=$('shareQR'),t=$('shareTitle');
  if(t) t.textContent=title||'åˆ†äº«é“¾æ¥'; if(!m||!input||!qr) return;
  input.value=link; qr.src='https://api.qrserver.com/v1/create-qr-code/?size=240x240&data='+encodeURIComponent(link);
  m.style.display='flex';
}
function __copyShare(){ var input=$('shareInput'); if(!input) return; input.select(); input.setSelectionRange(0,99999);
  try{ navigator.clipboard.writeText(input.value).then(function(){ alert('å·²å¤åˆ¶é“¾æ¥'); }); }catch(e){ try{ document.execCommand('copy'); alert('å·²å¤åˆ¶é“¾æ¥'); }catch(e2){ alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·é•¿æŒ‰è¾“å…¥æ¡†å¤åˆ¶'); } } }
function __shareLanding(){
  var link=__landingURL();
  try{
    if(navigator.share){ navigator.share({title:'æƒ…ç»ªåšç‰©é¦†', url:link}).catch(function(){ __openShare(link,'é‚€è¯·å¥½å‹æ¥ç©'); }); }
    else{ __openShare(link,'é‚€è¯·å¥½å‹æ¥ç©'); }
  }catch(e){ __openShare(link,'é‚€è¯·å¥½å‹æ¥ç©'); }
}
function __shareReplay(){
  var base=location.href.split('#')[0], hash=location.hash.slice(1);
  var link=base+'#'+(hash?(hash.indexOf('view=1')>=0?hash:hash+'&view=1'):'view=1');
  try{
    if(navigator.share){ navigator.share({title:'æˆ‘çš„ AI ä»ªå¼ï¼ˆå¯å›æ”¾ï¼‰', url:link}).catch(function(){ __openShare(link,'åˆ†äº«å®Œæ•´æµç¨‹'); }); }
    else{ __openShare(link,'åˆ†äº«å®Œæ•´æµç¨‹'); }
  }catch(e){ __openShare(link,'åˆ†äº«å®Œæ•´æµç¨‹'); }
}
function __tip(){ var m=$('tipModal'); if(m) m.style.display='flex'; }

/* åˆå§‹æ–‡æ¡ˆ */
badgeEl.textContent='ä¸º '+(data.yourName||'ä½ ')+' ä¸ '+(data.aiName||'TA')+' çš„ä»ªå¼ Â· NO.'+id;
mqEl.textContent=data.letter||'ï¼ˆåœ¨è¿™é‡Œï¼Œå¯¹è¿‡å»çš„è‡ªå·±æ¸©æŸ”åœ°é“ä¸€å£°å†è§â€¦ï¼‰';
</script>
</body></html>
