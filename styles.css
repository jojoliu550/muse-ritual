/* ========== 基础 UI ========== */
*{box-sizing:border-box}
:root{
  --fg:#e9e9f6; --muted:#aab0d9; --card:#121420; --line:#1e2230; --bg:#0b0d12; --accent:#7c5cff;
}
html,body{margin:0;background:var(--bg);color:var(--fg);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
a{color:#aeb7ff}
.container{max-width:980px;margin:24px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;margin:16px 0}
.hero{padding:48px 16px;text-align:center;background:radial-gradient(80% 60% at 50% 0%,#1e2030,var(--bg))}
.hero h1{margin:0;font-size:36px}
.muted{color:var(--muted)} .small{font-size:13px;color:var(--muted)}
label{display:block;margin:10px 0}
input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #2a2f45;background:#0d0f18;color:var(--fg)}
textarea{resize:vertical}
button{padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
button:hover{filter:brightness(1.08)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.kv{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.center{text-align:center}
.footer{padding:24px;text-align:center;color:var(--muted)}
canvas{width:100%;height:auto;border-radius:12px;border:1px solid var(--line)}

/* ========== 仪式舞台通用 ========== */
.scene{
  position:relative;width:100%;height:70vh;border-radius:16px;border:1px solid var(--line);
  overflow:hidden;background:#0b0d14;
}
.badge{position:absolute;top:16px;left:16px;background:rgba(255,255,255,.08);padding:8px 12px;border-radius:10px}
.countdown{position:absolute;top:16px;right:16px;background:rgba(0,0,0,.35);padding:8px 12px;border-radius:10px}
.marquee{position:absolute;bottom:12%;left:0;right:0;padding:0 24px;max-height:46%;
  overflow:auto;white-space:pre-wrap;line-height:1.8;pointer-events:none}
.actions{position:absolute;bottom:16px;left:0;right:0;text-align:center;z-index:3}
.actions button{margin:0 6px}

/* 开始遮罩 */
.hint-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.38);z-index:4}
.hint-card{min-width:260px;text-align:center;background:rgba(0,0,0,.55);border:1px solid #2a2f45;border-radius:14px;padding:16px 18px}
.hint-title{font-weight:600;margin-bottom:6px}
.hint-row{display:flex;gap:8px;justify-content:center;margin:8px 0}
.hint-card button{padding:8px 14px;border:0;border-radius:10px;background:#2a2f45;color:#e9e9f6;cursor:pointer}
.hint-card button.primary{background:#7c5cff}

/* 全场光晕 */
.glow{
  position:absolute;inset:-10%;
  background:radial-gradient(circle at 50% 70%,rgba(124,92,255,.16),transparent 60%);
  filter:blur(10px);animation:pulse 6s ease-in-out infinite;pointer-events:none
}
@keyframes pulse{0%{opacity:.5}50%{opacity:.9}100%{opacity:.5}}

/* —— 星空：深空 + 横向流动（宇宙感） —— */
.starfield{
  background:radial-gradient(120% 100% at 50% 80%, #0b0f1f 0%, #070a14 60%, #04060c 100%);
}
/* 一颗星：横向“流动” + 轻微闪烁 */
.star{
  position:absolute;
  width:2px;height:2px;border-radius:50%;
  background:#fff;opacity:var(--o,.85);
  box-shadow:0 0 6px 2px rgba(255,255,255,.35);
  /* 两个动画：先水平流动，再轻微闪烁作呼吸感 */
  animation:
    starFlow var(--spd,60s) linear infinite,
    starFlicker calc(3s + 3s * var(--r,.5)) ease-in-out infinite alternate;
}
/* 水平“流动”：把星从当前位置推到画面左侧之外 */
@keyframes starFlow{
  from{ transform:translateX(0); }
  to  { transform:translateX(-120vw); }
}
/* 轻微闪烁（不是主角，只是质感） */
@keyframes starFlicker{ from{opacity:.6} to{opacity:1} }

/* ========== 霓虹（极光 aurora） ========== */
.neon{
  background:radial-gradient(120% 100% at 50% 90%, #0b0f1f 0%, #070a14 60%, #04060c 100%);
}
/* 彻底禁用旧“扫描线”实现 */
.neon .scanline,.neon .laser,.neon .neon-scan{display:none!important}
.neon .neon-bar{position:absolute;inset:-40% -10% -40% -10%;background:none!important}

/* 双层极光光带 */
.neon .neon-bar::before,
.neon .neon-bar::after{
  content:'';position:absolute;left:-20%;width:140%;height:60%;
  background:conic-gradient(from 0deg at 50% 50%,
    rgba(90,150,255,0) 0%,
    rgba(90,150,255,.18) 20%,
    rgba(255,120,220,.22) 40%,
    rgba(120,255,220,.20) 60%,
    rgba(90,150,255,.18) 80%,
    rgba(90,150,255,0) 100%);
  filter:blur(42px);opacity:.55;transform:skewY(-6deg);
  animation:auroraA 16s ease-in-out infinite alternate;
  mix-blend-mode:screen;pointer-events:none
}
.neon .neon-bar::after{
  top:35%;height:70%;filter:blur(64px);opacity:.45;transform:skewY(8deg) scale(1.06);
  animation:auroraB 20s ease-in-out infinite alternate
}
@keyframes auroraA{from{transform:translateX(-6%) skewY(-6deg)}to{transform:translateX(6%) skewY(6deg)}}
@keyframes auroraB{from{transform:translateX(5%)  skewY(8deg) scale(1.06)}to{transform:translateX(-5%) skewY(-8deg) scale(1.06)}}
/* 少量暖色萤火点缀 */
.neon::after{
  content:'';position:absolute;inset:0;pointer-events:none;
  background-image:
    radial-gradient(2px 2px at 20% 30%, rgba(255,245,210,.75), transparent),
    radial-gradient(1.5px 1.5px at 60% 70%, rgba(255,245,210,.6), transparent),
    radial-gradient(2px 2px at 80% 40%, rgba(255,240,200,.65), transparent),
    radial-gradient(1.5px 1.5px at 30% 80%, rgba(255,250,220,.7), transparent);
  opacity:.55;filter:blur(.2px) drop-shadow(0 0 3px rgba(255,220,160,.35));
  animation:firefly 12s linear infinite
}
@keyframes firefly{from{transform:translateY(0)}to{transform:translateY(-12px)}}

/* ========== 烛光（candles） ========== */
.dark-vignette{
  background:radial-gradient(120% 100% at 50% 80%, #12131d 0%, #0d1018 55%, #090b12 100%);
  position:relative;
}
.dark-vignette::before{
  content:'';position:absolute;inset:0;
  background:
    radial-gradient(50% 60% at 50% 90%, rgba(255,170,80,.18), transparent 60%),
    radial-gradient(50% 60% at 50% 110%, rgba(255,120,60,.12), transparent 70%);
  pointer-events:none;mix-blend-mode:screen
}
/* JS 会插入 .flame，我们增强质感与抖动 */
.flame{
  position:absolute;width:8px;height:18px;
  background:radial-gradient(50% 70% at 50% 30%,
    rgba(255,230,150,.95),
    rgba(255,160,0,.85) 60%,
    rgba(255,120,0,.6) 80%,
    rgba(0,0,0,0) 100%);
  border-radius:50% 50% 50% 50%/60% 60% 40% 40%;
  filter:blur(.3px) drop-shadow(0 0 8px rgba(255,180,80,.8));
  animation:flicker var(--t,1.6s) ease-in-out infinite alternate, swayFlame 4s ease-in-out infinite
}
@keyframes flicker{0%{transform:translateY(0) scale(1)}100%{transform:translateY(-2px) scale(1.06)}}
@keyframes swayFlame{0%{transform:translateX(-1px)}100%{transform:translateX(1px)}}
.dark-vignette::after{
  content:'';position:absolute;inset:0;
  background-image:
    radial-gradient(2px 2px at 20% 30%, rgba(255,255,210,.75), transparent),
    radial-gradient(1.5px 1.5px at 60% 70%, rgba(255,255,210,.6), transparent),
    radial-gradient(2px 2px at 80% 40%, rgba(255,255,200,.65), transparent),
    radial-gradient(1.5px 1.5px at 30% 80%, rgba(255,255,220,.7), transparent);
  opacity:.7;filter:blur(.2px) drop-shadow(0 0 3px rgba(255,220,160,.4));
  animation:drift 10s linear infinite;pointer-events:none
}
@keyframes drift{from{transform:translateY(0)}to{transform:translateY(-10px)}}

/* ========== 重要兜底：强制动画运行 ========== */
/* 除非用户点了“暂停”或选择 motion=off，默认让舞台里的动画运行。
   用 !important 是为了压过历史样式或脚本暂停。*/
.scene *{animation-play-state:running !important}
/* ====== STARFIELD：持续流动 + 双流星 ====== */
.scene.starfield{
  background: radial-gradient(120% 100% at 50% 80%, #0b0f1f 0%, #070a14 60%, #04060c 100%);
  overflow: hidden;
}
.scene.starfield .star{
  position:absolute; width:2px; height:2px; border-radius:50%;
  background:#fff; box-shadow:0 0 6px rgba(255,255,255,.45);
  opacity:var(--o,.8);
  will-change: transform;
  animation: fly var(--spd,60s) linear infinite;   /* 关键：线性 + 无限循环 */
}
/* 星星从当前位置向左“飞”出屏幕后，自动从起点再来一遍 */
@keyframes fly{
  from { transform: translateX(0); }
  to   { transform: translateX(-130vw); }
}

/* 双流星（交错划过） */
.scene.starfield::before,
.scene.starfield::after{
  content:''; position:absolute; top:-8%; left:110%;
  width:2px; height:2px; border-radius:2px; transform:rotate(-18deg);
  background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.95), rgba(255,255,255,0));
  box-shadow:0 0 12px rgba(255,255,255,.9);
  opacity:0; will-change: transform, opacity;
  animation: meteor 12s linear infinite;
}
.scene.starfield::after{ animation-delay: 6s; }
@keyframes meteor{
  0%,86% { opacity:0; transform:translate(0,0) rotate(-18deg); }
  87%    { opacity:1; }
  100%   { opacity:0; transform:translate(-140vw, 40vh) rotate(-18deg); }
}

/* ====== NEON：极光 + 萤火虫 ====== */
.scene.neon{
  background: radial-gradient(120% 100% at 50% 90%, #0b0f1f 0%, #070a14 55%, #04060c 100%);
  overflow:hidden;
}
/* 极光光带（柔和左右摆动） */
.scene.neon .neon-bar{ position:absolute; inset:-40% -12% -40% -12%; pointer-events:none; }
.scene.neon .neon-bar::before,
.scene.neon .neon-bar::after{
  content:''; position:absolute; left:-20%; width:140%; height:60%;
  background: conic-gradient(from 0deg at 50% 50%,
    rgba(90,150,255,0) 0%,
    rgba(90,150,255,.18) 20%,
    rgba(255,120,220,.25) 40%,
    rgba(120,255,220,.22) 60%,
    rgba(90,150,255,.18) 80%,
    rgba(90,150,255,0) 100%);
  filter: blur(42px);
  opacity:.55;
  transform: skewY(-6deg);
  mix-blend-mode: screen;
  animation: auroraA 16s ease-in-out infinite alternate;
}
.scene.neon .neon-bar::after{
  top:35%; height:70%;
  filter: blur(64px); opacity:.45; transform: skewY(8deg) scale(1.06);
  animation: auroraB 20s ease-in-out infinite alternate;
}
@keyframes auroraA { from{ transform:translateX(-6%) skewY(-6deg);} to{ transform:translateX(6%) skewY(6deg);} }
@keyframes auroraB { from{ transform:translateX(5%)  skewY(8deg) scale(1.06);} to{ transform:translateX(-5%) skewY(-8deg) scale(1.06);} }

/* 霓虹场景的“萤火虫” */
.scene.neon .ff{
  position:absolute; width:3px; height:3px; border-radius:50%;
  background:#ffd27a;
  box-shadow:0 0 8px #ffd27a, 0 0 16px rgba(255,210,122,.8);
  opacity:.9; pointer-events:none;
  animation: firefly var(--t,12s) ease-in-out infinite;
}
@keyframes firefly{
  0%   { transform: translate(0,0); opacity:0; }
  10%  { opacity:.9; }
  50%  { transform: translate(var(--dx,6vw), -34vh); }
  100% { transform: translate(calc(var(--dx,6vw)*1.2), -58vh); opacity:0; }
}

/* 兜底：除非 motion=off/暂停，场景内动画默认运行 */
.scene * { animation-play-state: running; }




